---
description: Supabase integration rules for AstroMatch authentication and database
globs: src/lib/supabaseClient.ts src/lib/**/*supabase* src/app/auth/**/*
alwaysApply: false
---
# AstroMatch Supabase Rules

## ğŸ”§ Setup Rules
- **Environment Variables**: Use proper env var naming
  - `NEXT_PUBLIC_SUPABASE_URL`
  - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- **Client Initialization**: Initialize client once and reuse
- **Error Handling**: Handle Supabase errors gracefully

## ğŸ” Authentication Rules
- **OAuth Providers**: Support Google, Facebook, Apple
- **Email Magic Links**: Implement email authentication
- **Session Management**: Handle user sessions properly
- **User Profiles**: Create user profiles on first login

## ğŸ—„ï¸ Database Rules
- **Row Level Security**: Enable RLS on all tables
- **Policies**: Write secure RLS policies
- **Migrations**: Use Supabase migrations for schema changes
- **Backups**: Regular database backups

## ğŸ“Š Real-time Rules
- **Subscriptions**: Use Supabase real-time for chat
- **Event Handling**: Handle real-time events properly
- **Connection Management**: Manage WebSocket connections
- **Error Recovery**: Handle connection failures

## ğŸ”’ Security Rules
- **RLS Policies**: Secure all data access
- **API Keys**: Never expose service role keys
- **User Data**: Protect user privacy
- **Audit Logs**: Log important user actions

import fs from "fs";
import path from "path";

const SRC_DIR = "rules";
const OUT = ".cursorrules";

// sort lexicographically so 00-.. comes first, 99-.. last
const files = fs.readdirSync(SRC_DIR)
  .filter(f => f.endsWith(".md"))
  .sort((a,b) => a.localeCompare(b));

const banner = `# Generated .cursorrules
# DO NOT EDIT THIS FILE DIRECTLY.
# Source files live in /rules. Run: npm run rules:build
`;

const parts = [banner];
for (const f of files) {
  const p = path.join(SRC_DIR, f);
  const content = fs.readFileSync(p, "utf8").trim();
  parts.push(`\n\n# ========== ${f} ==========\n\n${content}\n`);
}

fs.writeFileSync(OUT, parts.join(""), "utf8");
console.log(`Wrote ${OUT} from ${files.length} file(s).`);
